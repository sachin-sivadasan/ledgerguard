---
title: 'Batch Lookup Subscriptions'
api: 'POST /v1/subscriptions/batch'
description: 'Retrieve payment status for multiple subscriptions in one request'
---

## Request Body

<ParamField body="ids" type="array" required>
  Array of Shopify GraphQL IDs to look up. Maximum 100 IDs per request.
</ParamField>

## Response

<ResponseField name="results" type="array" required>
  Array of subscription status objects that were found
</ResponseField>

<ResponseField name="notFound" type="array" required>
  Array of IDs that were not found in the system
</ResponseField>

<RequestExample>
```bash cURL
curl -X POST https://api.ledgerguard.app/v1/subscriptions/batch \
  -H "X-API-Key: lg_live_xxxxxxxxxxxx" \
  -H "Content-Type: application/json" \
  -d '{
    "ids": [
      "gid://shopify/AppSubscription/123",
      "gid://shopify/AppSubscription/456",
      "gid://shopify/AppSubscription/789"
    ]
  }'
```

```javascript Node.js
const response = await fetch('https://api.ledgerguard.app/v1/subscriptions/batch', {
  method: 'POST',
  headers: {
    'X-API-Key': process.env.LEDGERGUARD_API_KEY,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    ids: [
      'gid://shopify/AppSubscription/123',
      'gid://shopify/AppSubscription/456',
      'gid://shopify/AppSubscription/789'
    ]
  })
});
const data = await response.json();
```

```python Python
import requests
import os

response = requests.post(
    'https://api.ledgerguard.app/v1/subscriptions/batch',
    headers={
        'X-API-Key': os.environ['LEDGERGUARD_API_KEY'],
        'Content-Type': 'application/json'
    },
    json={
        'ids': [
            'gid://shopify/AppSubscription/123',
            'gid://shopify/AppSubscription/456',
            'gid://shopify/AppSubscription/789'
        ]
    }
)
data = response.json()
```
</RequestExample>

<ResponseExample>
```json 200
{
  "results": [
    {
      "subscriptionId": "gid://shopify/AppSubscription/123",
      "myshopifyDomain": "store-a.myshopify.com",
      "shopName": "Store A",
      "planName": "Pro Plan",
      "riskState": "SAFE",
      "isPaidCurrentCycle": true,
      "monthsOverdue": 0,
      "status": "ACTIVE"
    },
    {
      "subscriptionId": "gid://shopify/AppSubscription/456",
      "myshopifyDomain": "store-b.myshopify.com",
      "shopName": "Store B",
      "planName": "Basic",
      "riskState": "ONE_CYCLE_MISSED",
      "isPaidCurrentCycle": false,
      "monthsOverdue": 1,
      "status": "ACTIVE"
    }
  ],
  "notFound": [
    "gid://shopify/AppSubscription/789"
  ]
}
```

```json 400
{
  "error": {
    "code": "BAD_REQUEST",
    "message": "maximum 100 IDs per batch request"
  }
}
```
</ResponseExample>

## Use Cases

### Dashboard Loading

Efficiently load payment status for all subscriptions displayed on a dashboard:

```javascript
async function loadDashboard(subscriptionIds) {
  // Split into batches of 100
  const batches = [];
  for (let i = 0; i < subscriptionIds.length; i += 100) {
    batches.push(subscriptionIds.slice(i, i + 100));
  }

  // Fetch all batches in parallel
  const results = await Promise.all(
    batches.map(batch =>
      fetch('https://api.ledgerguard.app/v1/subscriptions/batch', {
        method: 'POST',
        headers: {
          'X-API-Key': process.env.LEDGERGUARD_API_KEY,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ ids: batch })
      }).then(r => r.json())
    )
  );

  // Combine results
  return {
    results: results.flatMap(r => r.results),
    notFound: results.flatMap(r => r.notFound)
  };
}
```

### Risk Filtering

Fetch all subscriptions and filter by risk state:

```javascript
const { results } = await fetchSubscriptionsBatch(allSubscriptionIds);

const atRisk = results.filter(s =>
  s.riskState === 'ONE_CYCLE_MISSED' ||
  s.riskState === 'TWO_CYCLES_MISSED'
);

const churned = results.filter(s =>
  s.riskState === 'CHURNED'
);

console.log(`At risk: ${atRisk.length}, Churned: ${churned.length}`);
```

## Limits

| Constraint | Value |
|------------|-------|
| Max IDs per request | 100 |
| Max concurrent requests | No limit (rate limits apply) |
| Request timeout | 30 seconds |
