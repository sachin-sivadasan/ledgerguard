---
title: 'Batch Lookup Usage Records'
api: 'POST /v1/usages/batch'
description: 'Retrieve billing status for multiple usage charges in one request'
---

## Request Body

<ParamField body="ids" type="array" required>
  Array of Shopify GraphQL IDs to look up. Maximum 100 IDs per request.
</ParamField>

## Response

<ResponseField name="results" type="array" required>
  Array of usage status objects that were found
</ResponseField>

<ResponseField name="notFound" type="array" required>
  Array of IDs that were not found in the system
</ResponseField>

<RequestExample>
```bash cURL
curl -X POST https://api.ledgerguard.app/v1/usages/batch \
  -H "X-API-Key: lg_live_xxxxxxxxxxxx" \
  -H "Content-Type: application/json" \
  -d '{
    "ids": [
      "gid://shopify/AppUsageRecord/111",
      "gid://shopify/AppUsageRecord/222",
      "gid://shopify/AppUsageRecord/333"
    ]
  }'
```

```javascript Node.js
const response = await fetch('https://api.ledgerguard.app/v1/usages/batch', {
  method: 'POST',
  headers: {
    'X-API-Key': process.env.LEDGERGUARD_API_KEY,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    ids: [
      'gid://shopify/AppUsageRecord/111',
      'gid://shopify/AppUsageRecord/222',
      'gid://shopify/AppUsageRecord/333'
    ]
  })
});
const data = await response.json();
```

```python Python
import requests
import os

response = requests.post(
    'https://api.ledgerguard.app/v1/usages/batch',
    headers={
        'X-API-Key': os.environ['LEDGERGUARD_API_KEY'],
        'Content-Type': 'application/json'
    },
    json={
        'ids': [
            'gid://shopify/AppUsageRecord/111',
            'gid://shopify/AppUsageRecord/222',
            'gid://shopify/AppUsageRecord/333'
        ]
    }
)
data = response.json()
```
</RequestExample>

<ResponseExample>
```json 200
{
  "results": [
    {
      "usageId": "gid://shopify/AppUsageRecord/111",
      "billed": true,
      "billingDate": "2024-02-20T15:00:00Z",
      "amountCents": 1500,
      "description": "500 API calls",
      "subscription": {
        "subscriptionId": "gid://shopify/AppSubscription/12345",
        "myshopifyDomain": "store-a.myshopify.com",
        "riskState": "SAFE",
        "isPaidCurrentCycle": true
      }
    },
    {
      "usageId": "gid://shopify/AppUsageRecord/222",
      "billed": false,
      "billingDate": null,
      "amountCents": 750,
      "description": "250 API calls",
      "subscription": {
        "subscriptionId": "gid://shopify/AppSubscription/12345",
        "myshopifyDomain": "store-a.myshopify.com",
        "riskState": "SAFE",
        "isPaidCurrentCycle": true
      }
    }
  ],
  "notFound": [
    "gid://shopify/AppUsageRecord/333"
  ]
}
```
</ResponseExample>

## Reconciliation Example

Compare your internal records with what Shopify billed:

```javascript
async function reconcileUsageCharges(internalRecords) {
  const shopifyGids = internalRecords.map(r => r.shopifyGid);

  const response = await fetch('https://api.ledgerguard.app/v1/usages/batch', {
    method: 'POST',
    headers: {
      'X-API-Key': process.env.LEDGERGUARD_API_KEY,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ ids: shopifyGids })
  });

  const { results, notFound } = await response.json();

  // Identify discrepancies
  const discrepancies = results.filter(usage => {
    const internal = internalRecords.find(r => r.shopifyGid === usage.usageId);
    return internal.amountCents !== usage.amountCents;
  });

  // Summary
  return {
    total: internalRecords.length,
    billed: results.filter(u => u.billed).length,
    pending: results.filter(u => !u.billed).length,
    notFound: notFound.length,
    discrepancies: discrepancies.length
  };
}
```
