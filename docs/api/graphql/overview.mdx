---
title: 'GraphQL Overview'
description: 'Flexible queries with the GraphQL API'
---

## Introduction

The GraphQL API provides a flexible alternative to REST. Request exactly the fields you need and combine multiple queries in a single request.

## Endpoint

```
POST https://api.ledgerguard.app/v1/graphql
```

## Authentication

Include your API key in the `X-API-Key` header:

```bash
curl -X POST https://api.ledgerguard.app/v1/graphql \
  -H "X-API-Key: lg_live_xxxxxxxxxxxx" \
  -H "Content-Type: application/json" \
  -d '{"query": "{ ... }"}'
```

## Why GraphQL?

<CardGroup cols={2}>
  <Card title="Request Only What You Need" icon="filter">
    Reduce payload size by selecting specific fields
  </Card>
  <Card title="Combine Queries" icon="layer-group">
    Fetch subscriptions and usage in one request
  </Card>
  <Card title="Strong Typing" icon="shield-check">
    Schema validation catches errors before execution
  </Card>
  <Card title="Self-Documenting" icon="book">
    Explore the schema with introspection
  </Card>
</CardGroup>

## Quick Example

```graphql
query {
  subscription(shopifyGid: "gid://shopify/AppSubscription/12345") {
    subscriptionId
    myshopifyDomain
    riskState
    isPaidCurrentCycle
  }
}
```

Response:

```json
{
  "data": {
    "subscription": {
      "subscriptionId": "gid://shopify/AppSubscription/12345",
      "myshopifyDomain": "cool-store.myshopify.com",
      "riskState": "SAFE",
      "isPaidCurrentCycle": true
    }
  }
}
```

## Available Queries

| Query | Description |
|-------|-------------|
| `subscription(shopifyGid: ID!)` | Get single subscription by GID |
| `subscriptionByDomain(domain: String!)` | Get subscription by store domain |
| `subscriptions(shopifyGids: [ID!]!)` | Batch lookup subscriptions |
| `usage(shopifyGid: ID!)` | Get single usage record |
| `usages(shopifyGids: [ID!]!)` | Batch lookup usage records |

## Making Requests

<CodeGroup>

```bash cURL
curl -X POST https://api.ledgerguard.app/v1/graphql \
  -H "X-API-Key: lg_live_xxxxxxxxxxxx" \
  -H "Content-Type: application/json" \
  -d '{
    "query": "query GetSubscription($gid: ID!) { subscription(shopifyGid: $gid) { riskState isPaidCurrentCycle } }",
    "variables": { "gid": "gid://shopify/AppSubscription/12345" }
  }'
```

```javascript Node.js
const response = await fetch('https://api.ledgerguard.app/v1/graphql', {
  method: 'POST',
  headers: {
    'X-API-Key': process.env.LEDGERGUARD_API_KEY,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    query: `
      query GetSubscription($gid: ID!) {
        subscription(shopifyGid: $gid) {
          riskState
          isPaidCurrentCycle
        }
      }
    `,
    variables: { gid: 'gid://shopify/AppSubscription/12345' }
  })
});

const { data, errors } = await response.json();
```

```python Python
import requests
import os

query = """
query GetSubscription($gid: ID!) {
  subscription(shopifyGid: $gid) {
    riskState
    isPaidCurrentCycle
  }
}
"""

response = requests.post(
    'https://api.ledgerguard.app/v1/graphql',
    headers={
        'X-API-Key': os.environ['LEDGERGUARD_API_KEY'],
        'Content-Type': 'application/json'
    },
    json={
        'query': query,
        'variables': {'gid': 'gid://shopify/AppSubscription/12345'}
    }
)

data = response.json()
```

</CodeGroup>

## Error Handling

GraphQL errors are returned in the `errors` array:

```json
{
  "data": null,
  "errors": [
    {
      "message": "Subscription not found",
      "code": "NOT_FOUND"
    }
  ]
}
```

Always check for both HTTP status codes and GraphQL errors:

```javascript
const response = await fetch('/v1/graphql', { ... });

if (!response.ok) {
  throw new Error(`HTTP ${response.status}`);
}

const { data, errors } = await response.json();

if (errors?.length > 0) {
  throw new Error(errors[0].message);
}

return data;
```

## Next Steps

<CardGroup cols={2}>
  <Card
    title="Schema Reference"
    icon="diagram-project"
    href="/graphql/schema"
  >
    Explore all types and fields
  </Card>
  <Card
    title="Query Examples"
    icon="code"
    href="/graphql/examples"
  >
    Copy-paste examples for common use cases
  </Card>
</CardGroup>
